"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return createDiffsOperation;
    }
});
const _diff = /*#__PURE__*/ _interop_require_default(require("../diff"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function createDiffsOperation(proceed, abort, context) {
    let { releases } = context;
    const { release, releaseGraph, dependentReleasesLength } = context, start = 1, deleteCount = dependentReleasesLength, dependentReleases = releases.splice(start, deleteCount), devDependentReleases = releases.splice(start), orderedDependencySubDirectoryPaths = releaseGraph.getOrderedDependencySubDirectoryPaths(), orderedDevDependencySubDirectoryPaths = releaseGraph.getOrderedDevDependencySubDirectoryPaths();
    sortReleases(dependentReleases, orderedDependencySubDirectoryPaths);
    sortReleases(devDependentReleases, orderedDevDependencySubDirectoryPaths);
    releases = [
        release,
        ...dependentReleases,
        ...devDependentReleases
    ];
    const diffs = [];
    releases.every((release)=>{
        const diff = _diff.default.fromRelease(release);
        if (diff === null) {
            abort();
            return;
        }
        diffs.push(diff);
        return true;
    });
    Object.assign(context, {
        diffs
    });
    proceed();
}
function sortReleases(releases, orderedSubDirectoryPaths) {
    releases.sort((releaseA, releaseB)=>{
        const releaseASubDirectoryPath = releaseA.getSubDirectoryPath(), releaseBSubDirectoryPath = releaseB.getSubDirectoryPath(), releaseASubDirectoryPathIndex = orderedSubDirectoryPaths.indexOf(releaseASubDirectoryPath), releaseBSubDirectoryPathIndex = orderedSubDirectoryPaths.indexOf(releaseBSubDirectoryPath);
        if (false) {
        ///
        } else if (releaseASubDirectoryPathIndex > releaseBSubDirectoryPathIndex) {
            return +1;
        } else if (releaseASubDirectoryPathIndex < releaseBSubDirectoryPathIndex) {
            return -1;
        }
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vcGVyYXRpb24vY3JlYXRlRGlmZnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCBEaWZmIGZyb20gXCIuLi9kaWZmXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNyZWF0ZURpZmZzT3BlcmF0aW9uKHByb2NlZWQsIGFib3J0LCBjb250ZXh0KSB7XG4gIGxldCB7IHJlbGVhc2VzIH0gPSBjb250ZXh0O1xuXG4gIGNvbnN0IHsgcmVsZWFzZSwgcmVsZWFzZUdyYXBoLCBkZXBlbmRlbnRSZWxlYXNlc0xlbmd0aCB9ID0gY29udGV4dCxcbiAgICAgICAgc3RhcnQgPSAxLFxuICAgICAgICBkZWxldGVDb3VudCA9IGRlcGVuZGVudFJlbGVhc2VzTGVuZ3RoLCAgLy8vXG4gICAgICAgIGRlcGVuZGVudFJlbGVhc2VzID0gcmVsZWFzZXMuc3BsaWNlKHN0YXJ0LCBkZWxldGVDb3VudCksXG4gICAgICAgIGRldkRlcGVuZGVudFJlbGVhc2VzID0gcmVsZWFzZXMuc3BsaWNlKHN0YXJ0KSxcbiAgICAgICAgb3JkZXJlZERlcGVuZGVuY3lTdWJEaXJlY3RvcnlQYXRocyA9IHJlbGVhc2VHcmFwaC5nZXRPcmRlcmVkRGVwZW5kZW5jeVN1YkRpcmVjdG9yeVBhdGhzKCksXG4gICAgICAgIG9yZGVyZWREZXZEZXBlbmRlbmN5U3ViRGlyZWN0b3J5UGF0aHMgPSByZWxlYXNlR3JhcGguZ2V0T3JkZXJlZERldkRlcGVuZGVuY3lTdWJEaXJlY3RvcnlQYXRocygpO1xuXG4gIHNvcnRSZWxlYXNlcyhkZXBlbmRlbnRSZWxlYXNlcywgb3JkZXJlZERlcGVuZGVuY3lTdWJEaXJlY3RvcnlQYXRocyk7XG5cbiAgc29ydFJlbGVhc2VzKGRldkRlcGVuZGVudFJlbGVhc2VzLCBvcmRlcmVkRGV2RGVwZW5kZW5jeVN1YkRpcmVjdG9yeVBhdGhzKTtcblxuICByZWxlYXNlcyA9IFtcbiAgICByZWxlYXNlLFxuICAgIC4uLmRlcGVuZGVudFJlbGVhc2VzLFxuICAgIC4uLmRldkRlcGVuZGVudFJlbGVhc2VzXG4gIF07XG5cbiAgY29uc3QgZGlmZnMgPSBbXTtcblxuICByZWxlYXNlcy5ldmVyeSgocmVsZWFzZSkgPT4ge1xuICAgIGNvbnN0IGRpZmYgPSBEaWZmLmZyb21SZWxlYXNlKHJlbGVhc2UpO1xuXG4gICAgaWYgKGRpZmYgPT09IG51bGwpIHtcbiAgICAgIGFib3J0KCk7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBkaWZmcy5wdXNoKGRpZmYpO1xuXG4gICAgcmV0dXJuIHRydWU7XG4gIH0pO1xuXG4gIE9iamVjdC5hc3NpZ24oY29udGV4dCwge1xuICAgIGRpZmZzXG4gIH0pO1xuXG4gIHByb2NlZWQoKTtcbn1cblxuZnVuY3Rpb24gc29ydFJlbGVhc2VzKHJlbGVhc2VzLCBvcmRlcmVkU3ViRGlyZWN0b3J5UGF0aHMpIHtcbiAgcmVsZWFzZXMuc29ydCgocmVsZWFzZUEsIHJlbGVhc2VCKSA9PiB7XG4gICAgY29uc3QgcmVsZWFzZUFTdWJEaXJlY3RvcnlQYXRoID0gcmVsZWFzZUEuZ2V0U3ViRGlyZWN0b3J5UGF0aCgpLFxuICAgICAgICAgIHJlbGVhc2VCU3ViRGlyZWN0b3J5UGF0aCA9IHJlbGVhc2VCLmdldFN1YkRpcmVjdG9yeVBhdGgoKSxcbiAgICAgICAgICByZWxlYXNlQVN1YkRpcmVjdG9yeVBhdGhJbmRleCA9IG9yZGVyZWRTdWJEaXJlY3RvcnlQYXRocy5pbmRleE9mKHJlbGVhc2VBU3ViRGlyZWN0b3J5UGF0aCksXG4gICAgICAgICAgcmVsZWFzZUJTdWJEaXJlY3RvcnlQYXRoSW5kZXggPSBvcmRlcmVkU3ViRGlyZWN0b3J5UGF0aHMuaW5kZXhPZihyZWxlYXNlQlN1YkRpcmVjdG9yeVBhdGgpO1xuXG4gICAgaWYgKGZhbHNlKSB7XG4gICAgICAvLy9cbiAgICB9IGVsc2UgaWYgKHJlbGVhc2VBU3ViRGlyZWN0b3J5UGF0aEluZGV4ID4gcmVsZWFzZUJTdWJEaXJlY3RvcnlQYXRoSW5kZXgpIHtcbiAgICAgIHJldHVybiArMTtcbiAgICB9IGVsc2UgaWYgKHJlbGVhc2VBU3ViRGlyZWN0b3J5UGF0aEluZGV4IDwgcmVsZWFzZUJTdWJEaXJlY3RvcnlQYXRoSW5kZXgpIHtcbiAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gIH0pO1xufVxuIl0sIm5hbWVzIjpbImNyZWF0ZURpZmZzT3BlcmF0aW9uIiwicHJvY2VlZCIsImFib3J0IiwiY29udGV4dCIsInJlbGVhc2VzIiwicmVsZWFzZSIsInJlbGVhc2VHcmFwaCIsImRlcGVuZGVudFJlbGVhc2VzTGVuZ3RoIiwic3RhcnQiLCJkZWxldGVDb3VudCIsImRlcGVuZGVudFJlbGVhc2VzIiwic3BsaWNlIiwiZGV2RGVwZW5kZW50UmVsZWFzZXMiLCJvcmRlcmVkRGVwZW5kZW5jeVN1YkRpcmVjdG9yeVBhdGhzIiwiZ2V0T3JkZXJlZERlcGVuZGVuY3lTdWJEaXJlY3RvcnlQYXRocyIsIm9yZGVyZWREZXZEZXBlbmRlbmN5U3ViRGlyZWN0b3J5UGF0aHMiLCJnZXRPcmRlcmVkRGV2RGVwZW5kZW5jeVN1YkRpcmVjdG9yeVBhdGhzIiwic29ydFJlbGVhc2VzIiwiZGlmZnMiLCJldmVyeSIsImRpZmYiLCJEaWZmIiwiZnJvbVJlbGVhc2UiLCJwdXNoIiwiT2JqZWN0IiwiYXNzaWduIiwib3JkZXJlZFN1YkRpcmVjdG9yeVBhdGhzIiwic29ydCIsInJlbGVhc2VBIiwicmVsZWFzZUIiLCJyZWxlYXNlQVN1YkRpcmVjdG9yeVBhdGgiLCJnZXRTdWJEaXJlY3RvcnlQYXRoIiwicmVsZWFzZUJTdWJEaXJlY3RvcnlQYXRoIiwicmVsZWFzZUFTdWJEaXJlY3RvcnlQYXRoSW5kZXgiLCJpbmRleE9mIiwicmVsZWFzZUJTdWJEaXJlY3RvcnlQYXRoSW5kZXgiXSwibWFwcGluZ3MiOiJBQUFBOzs7OytCQUlBOzs7ZUFBd0JBOzs7NkRBRlA7Ozs7OztBQUVGLFNBQVNBLHFCQUFxQkMsT0FBTyxFQUFFQyxLQUFLLEVBQUVDLE9BQU87SUFDbEUsSUFBSSxFQUFFQyxRQUFRLEVBQUUsR0FBR0Q7SUFFbkIsTUFBTSxFQUFFRSxPQUFPLEVBQUVDLFlBQVksRUFBRUMsdUJBQXVCLEVBQUUsR0FBR0osU0FDckRLLFFBQVEsR0FDUkMsY0FBY0YseUJBQ2RHLG9CQUFvQk4sU0FBU08sTUFBTSxDQUFDSCxPQUFPQyxjQUMzQ0csdUJBQXVCUixTQUFTTyxNQUFNLENBQUNILFFBQ3ZDSyxxQ0FBcUNQLGFBQWFRLHFDQUFxQyxJQUN2RkMsd0NBQXdDVCxhQUFhVSx3Q0FBd0M7SUFFbkdDLGFBQWFQLG1CQUFtQkc7SUFFaENJLGFBQWFMLHNCQUFzQkc7SUFFbkNYLFdBQVc7UUFDVEM7V0FDR0s7V0FDQUU7S0FDSjtJQUVELE1BQU1NLFFBQVEsRUFBRTtJQUVoQmQsU0FBU2UsS0FBSyxDQUFDLENBQUNkO1FBQ2QsTUFBTWUsT0FBT0MsYUFBSSxDQUFDQyxXQUFXLENBQUNqQjtRQUU5QixJQUFJZSxTQUFTLE1BQU07WUFDakJsQjtZQUVBO1FBQ0Y7UUFFQWdCLE1BQU1LLElBQUksQ0FBQ0g7UUFFWCxPQUFPO0lBQ1Q7SUFFQUksT0FBT0MsTUFBTSxDQUFDdEIsU0FBUztRQUNyQmU7SUFDRjtJQUVBakI7QUFDRjtBQUVBLFNBQVNnQixhQUFhYixRQUFRLEVBQUVzQix3QkFBd0I7SUFDdER0QixTQUFTdUIsSUFBSSxDQUFDLENBQUNDLFVBQVVDO1FBQ3ZCLE1BQU1DLDJCQUEyQkYsU0FBU0csbUJBQW1CLElBQ3ZEQywyQkFBMkJILFNBQVNFLG1CQUFtQixJQUN2REUsZ0NBQWdDUCx5QkFBeUJRLE9BQU8sQ0FBQ0osMkJBQ2pFSyxnQ0FBZ0NULHlCQUF5QlEsT0FBTyxDQUFDRjtRQUV2RSxJQUFJLE9BQU87UUFDVCxHQUFHO1FBQ0wsT0FBTyxJQUFJQyxnQ0FBZ0NFLCtCQUErQjtZQUN4RSxPQUFPLENBQUM7UUFDVixPQUFPLElBQUlGLGdDQUFnQ0UsK0JBQStCO1lBQ3hFLE9BQU8sQ0FBQztRQUNWO0lBQ0Y7QUFDRiJ9